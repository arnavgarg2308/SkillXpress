<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mentor Login | SkillXpress</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body{
min-height:100vh;
background:linear-gradient(rgba(99,102,241,.35),rgba(99,102,241,.35)),
url('https://images.unsplash.com/photo-1519389950473-47ba0277781c');
background-size:cover;
display:flex;
justify-content:center;
align-items:center;
font-family:'Segoe UI';
}

.auth-card{
background:rgba(255,255,255,.9);
padding:2rem;
border-radius:20px;
width:420px;
}

.hidden{display:none;}
</style>
</head>

<body>

<div class="auth-card">

<!-- LOGIN -->
<div id="mentorSignin">
<h3 class="text-center mb-3">Mentor Sign In</h3>

<input id="mLoginEmail" class="form-control mb-3" placeholder="Email">
<input id="mLoginPass" type="password" class="form-control mb-3" placeholder="Password">

<button class="btn btn-primary w-100" onclick="mentorSignin()">
Sign In
</button>

<p class="text-center mt-2">
New Mentor? <a href="#" onclick="showSignup()">Create Account</a>
</p>
</div>

<!-- SIGNUP -->
<div id="mentorSignup" class="hidden">

<h3 class="text-center mb-3">Mentor Signup</h3>

<input id="mName" class="form-control mb-2" placeholder="Full Name">
<input id="mEmail" class="form-control mb-2" placeholder="Email">
<input id="mPass" type="password" class="form-control mb-2" placeholder="Password">

<input id="mExpertise" class="form-control mb-2" placeholder="Expertise">

<textarea id="mDesc" class="form-control mb-3" placeholder="Description"></textarea>

<button class="btn btn-success w-100" onclick="mentorSignup()">
Sign Up
</button>

<p class="text-center mt-2">
Already mentor?
<a href="#" onclick="showSignin()">Sign In</a>
</p>

</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="auth.js"></script>

<script>

/* SCREEN SWITCH */
function showSignup(){
document.getElementById("mentorSignin").classList.add("hidden");
document.getElementById("mentorSignup").classList.remove("hidden");
}

function showSignin(){
document.getElementById("mentorSignup").classList.add("hidden");
document.getElementById("mentorSignin").classList.remove("hidden");
}

/* =========================
   MENTOR SIGNUP (EDGE FUNCTION)
========================= */
async function mentorSignup(){

const name=document.getElementById("mName").value;
const email=document.getElementById("mEmail").value;
const password=document.getElementById("mPass").value;
const expertise=document.getElementById("mExpertise").value;
const description=document.getElementById("mDesc").value;

const response = await fetch(
"https://ltxrynmhihxmmzrnnduw.supabase.co/functions/v1/create-mentor",
{
method:"POST",
headers:{
"Content-Type":"application/json"
},
body:JSON.stringify({
name,
email,
password,
expertise,
description
})
});

const result = await response.json();

if(result.error){
alert(result.error);
return;
}

alert("Mentor account created successfully");
showSignin();
}

/* =========================
   MENTOR LOGIN
========================= */
async function mentorSignin(){

const email=document.getElementById("mLoginEmail").value;
const password=document.getElementById("mLoginPass").value;

const { data,error } =
await supabaseClient.auth.signInWithPassword({
email,
password
});

if(error){
alert(error.message);
return;
}

/* ONLY MENTOR LOGIN (EMAIL MATCH) */
const { data:mentor, error:mentorError } =
await supabaseClient
.from("mentors")
.select("*")
.eq("email", data.user.email)
.maybeSingle();

if(!mentor){
  alert("Only mentors allowed");
  await supabaseClient.auth.signOut();
  return;
}


window.location.href="mentor-dashboard.html";
}

</script>

</body>
</html>