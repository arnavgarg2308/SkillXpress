<!DOCTYPE html>
<html>
<head>
<title>Upload Project</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

<div class="container py-5">
  <div class="card p-4 mx-auto" style="max-width:500px">
    <h4 class="fw-bold mb-3">ðŸ“¸ New Project</h4>

    <input type="file" id="image" class="form-control mb-2">
    <input type="text" id="title" class="form-control mb-2" placeholder="Project title">
    <textarea id="desc" class="form-control mb-2" placeholder="Caption / Description"></textarea>
    <input type="text" id="tech" class="form-control mb-3" placeholder="Tech stack (comma separated)">

    <button class="btn btn-primary w-100" onclick="uploadProject()">Upload</button>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="auth.js"></script>

<script>
async function uploadProject(){
  const { data:{session} } = await supabaseClient.auth.getSession();
  if(!session) return alert("Login required");

  const file = image.files[0];
  let imageUrl = null;

  if(file){
    const path = `${session.user.id}/${Date.now()}_${file.name}`;
    await supabaseClient.storage
      .from("project-images")
      .upload(path, file);

    const { data } = supabaseClient
      .storage
      .from("project-images")
      .getPublicUrl(path);

    imageUrl = data.publicUrl;
  }

  await supabaseClient.from("projects").insert({
    owner_id: session.user.id,
    title: title.value,
    description: desc.value,
    tech_stack: tech.value.split(","),
    image_url: imageUrl
  });

  alert("Project uploaded ðŸš€");
  window.location.href = "projects.html";
}
</script>

</body>
</html>
